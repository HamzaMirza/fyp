<!Doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="assets/css/bootstrap.css">
    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="stylesheet" href="assets/css/bootsnav.css">
    <link rel="stylesheet" href="assets/css/animate.css">
    <link rel="stylesheet" href="assets/css/font-awesome.min.css">
    <link rel="stylesheet" href="assets/css/responsive.css">
	<title>THE SMART INTERVIEWER</title>
	<link rel='shortcut icon' type='image/x-icon' href='assets/images/favicon.png' />
  </head>
  <body class="hide_now">
	<header>
		<!-- Start Navigation -->
		<nav class="navbar navbar-default navbar-sticky bootsnav">

			<!-- Start Top Search -->
			<div class="top-search">
				<div class="container">
					<div class="input-group">
						<span class="input-group-addon"><i class="fa fa-search"></i></span>
						<input type="text" class="form-control" placeholder="Search">
						<span class="input-group-addon close-search"><i class="fa fa-times"></i></span>
					</div>
				</div>
			</div>
			<!-- End Top Search -->

			<div class="container">            
				<!-- Start Atribute Navigation -->
				<div class="attr-nav">
					<ul>
						<li class="pro_btn"><a href="login.html" target="_blank">Login</a></li>
					</ul>
				</div>
				<!-- End Atribute Navigation -->

				<!-- Start Header Navigation -->
				<div class="navbar-header">
					<!--button type="button" class="navbar-toggle nav_tab" data-toggle="collapse" data-target="#navbar-menu">
						<i class="fa fa-bars"></i>
					</button -->
					<a class="navbar-brand" href="index.html"><img src="assets/images/logo.png" class="img-responsive" alt=""></a>
				</div>
				<!-- End Header Navigation -->

				<!-- Collect the nav links, forms, and other content for toggling -->
				<div class="collapse navbar-collapse" id="navbar-menu">
					<ul class="nav navbar-nav navbar-right" data-in="fadeInDown" data-out="fadeOutUp">
					<li><a></a></li><li><a></a></li><li><a></a></li><li><a></a></li>
					</ul>
				</div><!-- /.navbar-collapse -->
			</div>   
		</nav>
    <!-- End Navigation -->
	</header>
	
	
	<section id="login_div">
		<div class="container">
			<div class="row">
				<div class="col-lg-10 col-md-offset-1">
					<div class="login_border">
						<div class="page_title">
							<h3>Start now<br> to grow your Business</h3>
						</div>
						<div class="feature_list">
							<div class="form_div">
								<form >
								<div class="alert alert-success hide" role="alert"  id="successAlert">
									  <a  class="alert-link" id="errorMsg"></a>
								</div>
								  <div class="inner-addon right-addon">
									  <i class="glyphicon fa fa-envelope-o"></i>
									  <input type="email" class="form-control" placeholder="Email Address" name="email" required/>
								  </div>
								  <div class="inner-addon right-addon">
									  <i class="glyphicon fa fa-home "></i>
									  <input type="text" class="form-control" placeholder="Company name" name="company" required id="autocomplete" placeholder="Enter your address" />
								  </div>
								  <div class="inner-addon right-addon">
									  <i class="glyphicon fa fa-lock fa_lg"></i>
									  <input type="password" class="form-control" placeholder="Create Password" name="password" required/>
								  </div>
								  <label class="container_new"> <a href="https://www.boaton.fr/cgv" target="blank" class="term_link">I have read and accepted the terms and conditions</a>
									<input type="checkbox" name="checkbox" required>
									<span class="checkmark"></span>
								  </label>
								  <button type="submit" class="btn btn-default" style="display:none" id="submitButton" >Create an Account</button>
								  <button type="button" class="btn btn-default" onClick="reqSignUp()">Create an Account</button>
								  <div class="forgot">
									  <div class="create_link">
										<p>You Already have an account? <a href="login.html">Login Now</a></p>
									  </div>
								  </div>
								</form>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</section>
	<footer>
		<div class="container">
			<div class="row">
				<div class="col-lg-3 col-sm-3">
					<div class="footer_section">
						<div class="footer_logo">
							<a  href="index.html"><img src="assets/images/footer-logo.png"/></a>
						</div>
					</div>
				</div>
				<div class="col-lg-6 col-sm-6">
					<div class="footer_section">
						<div class="footer_app">
							<p>THE SMART INTERVIEWER</p>
							<ul>
								<li><a href="#" ><img src="assets/images/googleplay.jpg" class="img-responsive" alt="google play store"/></a></li>
							</ul>
						</div>
					</div>
				</div>
				<div class="col-lg-3 col-sm-3">
					<div class="footer_section">
						<div class="social_media">
							<ul>
								<li><a href="#"><i class="fa fa-facebook" aria-hidden="true"></i></a></li>
								<li><a  href="#"><i class="fa fa-twitter" aria-hidden="true"></i></a></li>
								<li><a href="#"><i class="fa fa-instagram" aria-hidden="true"></i></a></li>
								<li><a href="#"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li>
							</ul>
						</div>
					</div>
				</div>	
			</div>
		</div>
	</footer>
	
  <script src="assets/js/jquery.js"></script>
  <script src="assets/js/bootstrap.min.js"></script>
  <script src="assets/js/bootsnav.js"></script>
    <script>
	 $('form').bind('keypress', function(e) {
            if(e.keyCode==13){
			   e.preventDefault();
                 reqSignUp();
             }
        });
	$('document').bind('keypress', function(e) {
            if(e.keyCode==13){
                 reqSignUp();
             }
        });
	function getOpeningHours(weekdays,dayIndex,timeIndex)
	{
		let a=[];
			a=weekdays[dayIndex].substr(weekdays[dayIndex].indexOf(':')+1).trim().split(/â€“/);
			if(a.length==1)
			{
				if(a[0]=="Open 24 hours")
				{
					if(timeIndex==0)
							return "00:00";
					else if(timeIndex==1)
						return "23:59";
				}
				else if(a[0]=="Closed")
				{
					return "00:00";
				}
			}
			else
			{
				if(a[timeIndex].indexOf('AM')>-1)
					return a[timeIndex].substring(0,a[timeIndex].indexOf('AM')).trim();
				else if(a[timeIndex].indexOf('PM')>-1)
				{
					let t=a[timeIndex].substring(0,a[timeIndex].indexOf('PM')).trim().split(/:/g);
						t[0]=parseInt(t[0].split(/:/g))+12;
						if(t[0]>=24)
							t[0]-=24;
					return t[0]+":"+t[1];
						
				}
			}
			
			
	}
  function reqSignUp()
 {

	let isSet=false;
	var createAllErrors = function() 
	{
		var form = $(this);
		var showAllErrorMessages = function() {
		// Find all invalid fields within the form.
		var invalidFields = form.find( ":invalid" ).each( function( index, node ) {
			$('#submitButton').click();
		});
		if(invalidFields.length<=0)
			isSet=true;
	};
		showAllErrorMessages();
	};
	$('form').each(createAllErrors);
	if(isSet)
	{
		if($('#autocomplete').val()=='No Place Found !!')
		{
			$('#autocomplete').val="";
			$('#submitButton').click();
		}
		else if(companyDetails['companyName']=='')
		{
			$('#autocomplete').val('No Place Found !!');
		}
		else
			ajaxCall_register();
	}
	
 }
 var companyDetails = {
		companyName:'',
		googleID:'',
        street_number: '',
        route: '',
        locality: '',
        administrative_area_level_1: '',
        country: '',
        postal_code: '',
		lat:'',
		lng:'',
		opening:{},
		phoneNo:''
      };
 function ajaxCall_register()
 {
			if(localStorage.getItem("company"))
				localStorage.removeItem("company");
		let timings=[];
		for(let i=0;i<7;i++)
		{
			if(companyDetails.opening!='undefined' && companyDetails.opening!=null && companyDetails.opening!='') 
				timings.push({
								's':getOpeningHours(companyDetails.opening['weekday_text'],i,0),
								'e':getOpeningHours(companyDetails.opening['weekday_text'],i,1),
							});
			else
			{
				if(i!=6)
					timings.push({
									's':"09:00",
									'e':"18:00"
								});
				else
					timings.push({
								's':"00:00",
								'e':"00:00"
							});
			}
		}
 		
	$.ajax({  //Company Create
					type: 'POST', 
					url: 'https://www.boaton.ch/api/companyandusercreate.php',  
					dataType: 'json',
					data:{
							'email':$('input[name=email]').val(),
							'company_name':companyDetails['companyName'],
							'city':companyDetails['locality'],
							'street':companyDetails['street_number'],
							'postal_code':companyDetails['postal_code'],
							'country':companyDetails['country'],
							'phone_1':companyDetails['phoneNo'],
							'google_place_id':companyDetails['googleID'],
							'lng':companyDetails['lng'],
							'lat':companyDetails['lat'],
							'language':1,
							'password':$('input[name=password]').val(),
							"openingtimes[1][Weekday]":1,
							"openingtimes[1][OpeningTime]":timings[0]['s'],
							"openingtimes[1][ClosingTime]":timings[0]['e'],
							"openingtimes[2][Weekday]":2,
							"openingtimes[2][OpeningTime]":timings[1]['s'],
							"openingtimes[2][ClosingTime]":timings[1]['e'],
							"openingtimes[3][Weekday]":3,
							"openingtimes[3][OpeningTime]":timings[2]['s'],
							"openingtimes[3][ClosingTime]":timings[2]['e'],
							"openingtimes[4][Weekday]":4,
							"openingtimes[4][OpeningTime]":timings[3]['s'],
							"openingtimes[4][ClosingTime]":timings[3]['e'],
							"openingtimes[5][Weekday]":5,
							"openingtimes[5][OpeningTime]":timings[4]['s'],
							"openingtimes[5][ClosingTime]":timings[4]['e'],
							"openingtimes[6][Weekday]":6,
							"openingtimes[6][OpeningTime]":timings[5]['s'],
							"openingtimes[6][ClosingTime]":timings[5]['e'],
							"openingtimes[7][Weekday]":7,
							"openingtimes[7][OpeningTime]":timings[6]['s'],
							"openingtimes[7][ClosingTime]":timings[6]['e']
						},
					success: function (data)
					{ 
						localStorage.setItem("company", JSON.stringify(
						{
							companyName:companyDetails['companyName'],
							street_number:companyDetails['street_number'],
							route:companyDetails['route'],
							locality:companyDetails['locality'],
							administrative_area_level_1:companyDetails['administrative_area_level_1'],
							country:companyDetails['country'],
							postal_code:companyDetails['postal_code'],
							lat:companyDetails['lat'],
							lng:companyDetails['lng'],
							opening_hours:companyDetails['opening'],
							phone:companyDetails['phoneNo'],
							CompanyID:data.User.CompanyID,
							UserID:data.User.UserID
						}
						));
						localStorage.setItem("user", JSON.stringify({userName:data.User.UserName,email:data.User.Email,isLogin:"1",token:data.AccessToken}));
						location.href="companyinfo.html";
						console.log(data);
					},
					error: function(error)
					{
						console.log("error",JSON.parse(error.responseText)["error"])
							showError(JSON.parse(error.responseText)["error"]);
					}
		  });
 }
  </script>
  
  
    <script>
      var placeSearch, autocomplete;
      var componentForm = {
        street_number: 'short_name',
        route: 'long_name',
        locality: 'long_name',
        administrative_area_level_1: 'short_name',
        country: 'long_name',
        postal_code: 'short_name'
      };

      function initAutocomplete() {
        autocomplete = new google.maps.places.Autocomplete(
            /** @type {!HTMLInputElement} */(document.getElementById('autocomplete')),
            {types: ['establishment']});
        autocomplete.addListener('place_changed', fillInAddress);
      }

      function fillInAddress() {
        var place = autocomplete.getPlace();
		
		if(place.address_components)
		{
			for (var i = 0; i < place.address_components.length; i++) {
			  var addressType = place.address_components[i].types[0];
			  if (componentForm[addressType]) {
				var val = place.address_components[i][componentForm[addressType]];
				companyDetails[addressType]=val;
			  }
			}
			companyDetails['googleID']=place.place_id;
			companyDetails['lat']=place.geometry.location.lat();
			companyDetails['lng']=place.geometry.location.lng();
			companyDetails['opening']=place.opening_hours;
			if(place.formatted_phone_number)
			companyDetails['phoneNo']=place.formatted_phone_number;
			console.log(companyDetails);
			companyDetails['companyName']=document.getElementById('autocomplete').value.substring(0,document.getElementById('autocomplete').value.indexOf(','));
		}
		else
			document.getElementById('autocomplete').value="No Place Found !!";
        
      }
      function geolocate() {
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(function(position) {
            var geolocation = {
              lat: position.coords.latitude,
              lng: position.coords.longitude
            };
            var circle = new google.maps.Circle({
              center: geolocation,
              radius: position.coords.accuracy
            });
            autocomplete.setBounds(circle.getBounds());
          });
        }
      }
	  function showError(msg)
 {
	
	$("#errorMsg").html(msg);
	$("#successAlert").removeClass("hide");
 }
    </script>

    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDOh2lUrwNRUs4NKSgTaLORFJD7SGwbWsg&libraries=places&callback=initAutocomplete"
        async ></script>
  </body>
  </html>